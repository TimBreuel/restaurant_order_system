<!DOCTYPE html>
<html lang="zxx" class="no-js">
  <head>
    <%- include('partials/header') %>
  </head>
  <body>
    <div class="pos-f-t">
      <div class="collapse" id="navbarToggleExternalContent">
        <div class="bg-dark p-4">
          <h4 class="text-white">Your orders:</h4>
          <span class="text-muted"
            >When you want delete a meal click the x button</span
          >
          <ul class="ul-cart-list"></ul>
        </div>
      </div>
      <nav class="navbar navbar-dark bg-dark">
        <button
          class="navbar-toggler"
          type="button"
          data-toggle="collapse"
          data-target="#navbarToggleExternalContent"
          aria-controls="navbarToggleExternalContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class=""
            ><svg
              width="1em"
              height="1em"
              viewBox="0 0 16 16"
              class="bi bi-basket2-fill"
              fill="currentColor"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                fill-rule="evenodd"
                d="M11.314 1.036a.5.5 0 0 1 .65.278l2 5a.5.5 0 1 1-.928.372l-2-5a.5.5 0 0 1 .278-.65zm-6.628 0a.5.5 0 0 0-.65.278l-2 5a.5.5 0 1 0 .928.372l2-5a.5.5 0 0 0-.278-.65z"
              />
              <path
                fill-rule="evenodd"
                d="M1.5 7a.5.5 0 0 0-.489.605l1.5 7A.5.5 0 0 0 3 15h10a.5.5 0 0 0 .489-.395l1.5-7A.5.5 0 0 0 14.5 7h-13zM4 10a1 1 0 0 1 2 0v2a1 1 0 1 1-2 0v-2zm3 0a1 1 0 0 1 2 0v2a1 1 0 1 1-2 0v-2zm4-1a1 1 0 0 0-1 1v2a1 1 0 1 0 2 0v-2a1 1 0 0 0-1-1z"
              />
              <path
                d="M0 6.5A.5.5 0 0 1 .5 6h15a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H.5a.5.5 0 0 1-.5-.5v-1z"
              />
            </svg>
          </span>
        </button>
        
        <button
          class="navbar-toggler"
          type="button"
          id="sendOrder"
          style="font-weight: 300; font-size: 18px;"
        >
          Send order
        </button>
        <button
          class="navbar-toggler"
          type="button"
          id="needService"
          style="font-weight: 300; font-size: 18px;"
        >
          Need service
        </button>
        <button
          class="navbar-toggler"
          type="button"
          id="wantsToPay"
          style="font-weight: 300; font-size: 18px;"
        >
          Wants to pay
        </button>
        <div>
          <a
            class="navbar-brand tableIdLogout"
            href="/login/logout"
            restaurantid="<%= tableMenu[0].restaurantId %>"
            tableid="<%= tableMenu[0]._id %>"
            >Table: #<%= tableMenu[0].table_number %> Logout</a
          >
        </div>
      </nav>
    </div>

    <!-- Start menu-area Area -->
    <section class="menu-area section-gap" id="menu" style="padding-top: 70px;">
      <div class="container">
        <ul class="filter-wrap filters col-lg-12 no-padding">
          <li class="active" data-filter="*">All Menu</li>
          <li data-filter=".drinks">Drinks</li>
          <li data-filter=".breakfast">Breakfast</li>
          <li data-filter=".lunch">Lunch</li>
          <li data-filter=".dinner">Dinner</li>
        </ul>

        <div class="filters-content">
          <div class="row grid">
            <!-- JSX LOOP TO RENDER MENU -->
            <% tableMenu[1].forEach(meal => { %> <% if (meal.img !== '') { %>
            <div class="col-md-6 all <%= meal.category %>">
              <div class="single-menu">
                <div class="row">
                  <div class="col-md-4" style="padding: 0 0 0 0;">
                    <img
                      src="<%= meal.img %> "
                      alt=""
                      width="100%"
                      height="150px"
                      class="rounded"
                    />
                  </div>
                  <div class="col-md-8">
                    <div class="title-wrap d-flex justify-content-between">
                      <% if (meal.number !== '') { %>
                      <h4 mealId="<%= meal._id %>">
                        <%= meal.number %> <%= meal.title %>
                      </h4>
                      <h4 class="price">$<%= meal.price %></h4>
                      <% }else{ %>
                      <h4 mealId="<%= meal._id %>"><%= meal.title %></h4>
                      <h4 class="price">$<%= meal.price %></h4>
                      <% } %>
                    </div>
                    <p>
                      <%= meal.description %>
                    </p>
                    <button
                      class="btn btn-block bg-light addToCardBtn mt-5"
                      mealId="<%= meal._id %>"
                    >
                      Add to cart
                    </button>
                  </div>
                </div>
              </div>
            </div>
            <% }else{ %>
            <div class="col-md-6 all <%= meal.category %>">
              <div class="single-menu">
                <div class="title-wrap d-flex justify-content-between">
                  <% if (meal.number !== '') { %>
                  <h4 mealId="<%= meal._id %>">
                    <%= meal.number %> <%= meal.title %>
                  </h4>
                  <h4 class="price">$<%= meal.price %></h4>
                  <% }else{ %>
                  <h4 mealId="<%= meal._id %>"><%= meal.title %></h4>
                  <h4 class="price">$<%= meal.price %></h4>
                  <% } %>
                </div>
                <p>
                  <%= meal.description %>
                </p>
                <button class="btn btn-block bg-light addToCardBtn mt-5">
                  Add to cart
                </button>
              </div>
            </div>
            <% } %> <% }) %>
          </div>
        </div>
      </div>
    </section>
    <!-- End menu-area Area -->

    <!-- start footer Area -->
    <%- include('partials/footer') %>
    <!-- End footer Area -->

    <%- include('partials/scripts') %>

    <script>
      //////////////////////
      //UI SELECTORS GLOBAL
      const ulCartList = document.querySelector(".ul-cart-list");
      /////////////////////////
      //ADD A MEAL TO THE CART
      const addToCardBtn = document.querySelectorAll(".addToCardBtn");
      addToCardBtn.forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          let liElement = document.createElement("li");
          liElement.classList.add("orderListItem");
          liElement.innerHTML = `<h4 class="text-white" mealId="${e.target.parentElement.children[0].children[0].getAttribute(
            "mealId"
          )}"><span class="deleteMealItem text-danger">X</span> ${
            e.target.parentElement.children[0].children[0].innerText
          }</h4>`;
          ulCartList.prepend(liElement);
          liElement.children[0].children[0].addEventListener("click", (e) => {
            e.preventDefault();
            e.target.parentElement.parentElement.remove();
          });
        });
      });
      ////////////////////////////
      //SEND ORDER TO THE DATABASE
      const sendOrder = document.querySelector("#sendOrder");
      sendOrder.addEventListener("click", (e) => {
        const orderListItem = document.querySelectorAll(".orderListItem");
        let orderListArr = [];
        orderListItem.forEach((orderItem) => {
          console.log(orderItem.children[0].getAttribute("mealId"));
          orderListArr.push(orderItem.children[0].getAttribute("mealId"));
        });
        const tableIdLogout = document.querySelector(".tableIdLogout");

        let data = {
          restaurantId: tableIdLogout.getAttribute("restaurantId"),
          tableId: tableIdLogout.getAttribute("tableid"),
          order: orderListArr,
        };
        postDataTable("/login/table/sendOrder", data).then((response) => {
          const navBar = document.querySelector(".menu-area");

          switch (response) {
            case 1:
              // const successDiv = document.createElement("div");
              // successDiv.innerHTML = `<div class="text-success" style="text-align:center; font-size:18px;">Successfully ordered</div>`;
              // navBar.append(successDiv);
              // setTimeout(() => {
              //   navBar.remove(successDiv);
              //   ulLiDeleteList.innerHTML = "";
              // }, 2000);
              const ulLiDeleteList = document.querySelector(".ul-cart-list");
              ulLiDeleteList.innerHTML = "";
              alert("Success");
              break;
            case 2:
              // const NoSuccessDiv = document.createElement("div");
              // NoSuccessDiv.innerHTML = `<div class="text-success" style="text-align:center; font-size:18px;">Somthing goes wrong!</div>`;
              // navBar.append(NoSuccessDiv);
              // setTimeout(() => {
              //   navBar.remove(NoSuccessDiv);
              // }, 2000);
              alert("Something goes wrong");
              break;

            default:
              break;
          }
        });
      });

      async function postDataTable(url = "", data = {}) {
        const response = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });
        return response.json();
      }
    </script>
  </body>
</html>
